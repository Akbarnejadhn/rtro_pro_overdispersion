---
title: "retro_prospect_overdispersion"
author: "Hana Akbarnejad"
date: "2/22/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(viridis)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))

```

## Problem 1

This problem investigates data deriven from a retrospective study that studies the relationship between alcohol consumption (alcohol concentration) and emergence of cancer. The study has been adjusted for age.

```{r data}

# help myself understand the data (retrospective data):

###############################################################################
#
#                       case(cancer+)         control(cancer-) 
#
# #exosed (alcohol80+)      96                        109             n1=205
# #unexposed (alc 80-)      104                       666             n0=770
#                           
#                           m1=200                    m0=775
#
#
################################################################################

cancer_data = tibble(
  age = rep(c(25, 35, 45, 55, 65, 75), 2),
  alcohol_consump = c(rep("0-79 g", 6), rep("80+ g", 6)),
  case = c(0, 5, 21, 34, 36, 8, 1, 4, 25, 42, 19, 5),
  control = c(106, 164, 138, 139, 88, 31, 9, 26, 29, 27, 18, 0)
)

m1_df = cancer_data %>% 
  group_by(alcohol_consump) %>%
  select(case) %>% 
  summarize(sum_case = sum(case))

m1 = sum(m1_df$sum_case)

m0_df = m1 = cancer_data %>% 
  group_by(alcohol_consump) %>%
  select(control) %>% 
  summarize(sum_cntrl = sum(control))

m0 = sum(m0_df$sum_cntrl)

# using table to calculate n1 and n0
n1 = 205
n0 = 770
# now I know what my table looks like!
```

Note that this is retrospective data, so we cannot use it to calculate relative risk (RR), even with fitting prospective model. But we can treat the study as prospective (despite the fact that the data has been collected retrospectively) and treat disease status as response.

Fitting a prospective model to this data, we will have the following result:

```{r pros_model}

# fitting a prospective model
response = cbind(cancer_data$case, cancer_data$control)
# fit logit model
logit_prosp = glm(response ~ cancer_data$alcohol_consump + cancer_data$age, family=binomial(link='logit'))
summary(logit_prosp)
```


$$Y_i = \beta_0 + \beta_1X_{1i} + \beta_2 X_{2i}$$

We can observe that the estimate for $\beta_1$ is `r summary(logit_prosp)$coefficients[2,1]`, this means that the log odds ration of developing cancer is `r round(summary(logit_prosp)$coefficients[2,1], 2)` for the exposed group (the group with daily alcohol comsumption of equal to or more than 80 grams) compared to unexposed group (the group with daily alcohol comsumption of 0-79 grams), holding age constant.

Also, we can observe that the estimate for $\beta_2$ is `r summary(logit_prosp)$coefficients[3,1]`, this means that the log odds ration of developing cancer is `r round(summary(logit_prosp)$coefficients[3,1], 2)` for each one unit(10 years here) increase in age, holding exposure (alcohol consumption status) constant.
